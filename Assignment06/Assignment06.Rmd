---
title: "Assignment 6"
author: "Max Selvaggio"
date: '2022-07-24'
output: 
  html_document:
    toc: true
    toc_float: true
    number_sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r packages}
library(plotly)
library(gvlma)
library(car)
```

We are going to look at the property prices for Orange County. From there we are going to try and predict the sales price by linear regression.

# Importing Data 

Bring in the data and make sure the data types are correct. If not, make the proper changes. The file is located within this project. *data/prop_prices_reduced.csv*

```{r}
prices <- read.csv("C:\\Users\\mselv\\Documents\\GitHub\\ECO5445SU22\\Assignment06\\
                   data\\prop_prices_reduced.csv")
str(prices)
```


# Plotting

Plot histograms for all variables. Additionally, add scatterplots for the relationships between all quantitative variables.

```{r}
hist(prices$sale_def)
hist(prices$bed)
hist(prices$bath)
hist(prices$area_heated)
hist(prices$area)
hist(prices$dist_cbd)
hist(prices$dist_lakes)
hist(prices$pool)

plot_ly(prices, y = ~sale_def, x = ~bed, type = 'scatter')
plot_ly(prices, y = ~sale_def, x = ~area_heated, type = 'scatter')
plot_ly(prices, y = ~sale_def, x = ~area, type = 'scatter')
plot_ly(prices, y = ~sale_def, x = ~bath, type = 'scatter')
plot_ly(prices, y = ~dist_lakes, x = ~area, type = 'scatter')
plot_ly(prices, y = ~area_heated, x = ~bath, type = 'scatter')
plot_ly(prices, y = ~area_heated, x = ~dist_lakes, type = 'scatter')
plot_ly(prices, y = ~sale_def, x = ~dist_lakes, type = 'scatter')
plot_ly(prices, y = ~sale_def, x = ~dist_cbd, type = 'scatter')

```

# Summary Statistics

Provide basic summary statistics for univariate analysis. Also, provide the correlation between all the quantitative variables.

```{r}
data <- prices$sale_def
mean(data)
median(data)
max(data)
min(data)

quant_var <- data.frame(prices$sale_def,prices$bed,prices$bath,prices$area_heated,prices$area,
                        prices$dist_cbd,prices$dist_lakes)
cor(quant_var)
```

# Regression Analysis

Run a regression with all the variables included. Print results of the regression.

```{r}
model <- lm(sale_def ~ bed + bath + area_heated + area + 
              dist_cbd + dist_lakes + pool, data = prices)
summary(model)
```

Which of the variables tested significant at the 95% level? Looking at the results and answering outside of the chunk is sufficient.
Answer: bed, bath, area_heated, area, dist_cbd

## Evaluating the model

As is, are any of the Gauss-Markov assumptions violated? If so, which ones? How can you fix the issues?

```{r}
gvmodel <- gvlma(model)
summary(gvmodel)

```

## New Model

Based off of your findings in the previous section, make changes to the variables, the functional form, etc.

```{r}
outlierTest(model)
newdata <- prices[-c(7, 37, 214), ]

newmodel <- lm(sale_def ~ bed + bath + area_heated + area + 
              dist_cbd + dist_lakes + pool, data = newdata)
```


# Prediction

Based on the following inputs, predict the deflated sales price:

- 2 bed
- 2 bath
- area_heated = 1223
- area = 9750
- dist_cbd = 19368
- dist_lakes = 490
- no pool

```{r}
Example1 <- data.frame(bed = 2,
                   bath = 2.0,
                   area_heated = 1223,
                   area = 9750,
                   dist_cbd = 19368,
                   dist_lakes = 490,
                   pool = 0)
                   

predict(newmodel, Example1)
 
```
